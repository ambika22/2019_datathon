---
title: "PAWS Datathon Submission Form"
author: "R-Ladies"
date: '`r format(Sys.Date(), "%B %d, %Y")`'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r include=F, warning=F}
library(tidyverse)
```

## Executive Summary
<span style="color:gray">*This section should have up to 5 bullet points summarizing the main conclusions from the analysis. These should be worded in such a way that PAWS management can easily understand what actios would be beneficial. It can be a shorter version of the conclusions section below.*</span>

* Tweets were analyzed to understand any patterns in twitter activity and whether that could be linked to application or pet information
* No strong trends or observations were gained, but it was fun to look at the data
* We did not see a strong assocation between twitter activity and applications
* We identified the most commonly tweeted words such as "home","adoption",and "meet"
* We found that tweets with photos were more often favorited and retweeted


## Contributors

<span style="color:gray">*This section should list the names and 1-2 sentence descriptions of everyone who worked on the submission. An example is listed below (please replace the example with your own info).*</span>

**Alice M Walsh, PhD** is a computational biologist in the pharmaceutical industry. She enjoys analyzing patient data and trying to make informed decisions using data. She also enjoys walking and training her dog, Pebbles.

## Problem definition and dataset

<span style="color:gray">*This section should summarize the question your group has worked on, as well as any working definitions that you used (beyond what was outlined in the general description). Additionally, this section should contain any issues or challenges that you noticed in the data, that may be relevant.*</span>

We examined the data from the PAWS twitter account, @phillypaws. We used the twitter API to download the most recent 3200 tweets, which included all tweets from 2018. Quotes and retweets were not excluded from the dataset.

## Results

<span style="color:gray">*You may structure this section in any way that makes results easier to understand and describe.*</span>
```{r}
# Load in data - previously pulled with rtweet package
tweets <- readRDS('tweets_13FEB2019.Rds')
# Let's focus on 2018 to match other datasets
tweets_18 <- filter(tweets, created_at < as.Date("2019-01-01"), created_at > as.Date("2018-01-01"))
```

```{r}
tweets %>% 
  mutate(created_day = lubridate::floor_date(created_at, unit = "day")) %>% 
  count(created_day) %>% 
  ggplot(aes(x=created_day, y=n)) + 
  geom_line() + 
  theme_bw() + 
  ggtitle("Volume of recent @phillypaws tweets")

```

```{r}
# Let's count tweets by day-of-the-week, week, month, and look for trends
# Plot by week:
tweets_18 %>% 
  mutate(week = lubridate::floor_date(created_at, unit = "week")) %>% 
  group_by(week) %>% 
  summarise(favorites = sum(favorite_count),
            tweets = n(),
            retweets = sum(retweet_count)) %>% 
  gather(metric, total, favorites:retweets) %>% 
  ggplot(aes(x=week, y=total)) + 
  geom_col() +
  facet_grid(metric~., scales = "free") +
  theme_bw() + 
  ggtitle("2018 @phillypaws stats by week")

```

```{r}
# Plot by month:
tweets_18 %>% 
  mutate(month = lubridate::floor_date(created_at, unit = "month")) %>% 
  group_by(month) %>% 
  summarise(favorites = sum(favorite_count),
            tweets = n(),
            retweets = sum(retweet_count)) %>% 
  gather(metric, total, favorites:retweets) %>% 
  ggplot(aes(x=month, y=total)) + 
  geom_col() +
  facet_grid(metric~., scales = "free") +
  theme_bw() + 
  ggtitle("2018 @phillypaws stats by month")


```

```{r}
# Plot by day-of-the-week:
tweets_18 %>% 
  mutate(weekday = weekdays(created_at)) %>%
  mutate(weekday = factor(weekday, 
                               levels = c("Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"))) %>% 
  group_by(weekday) %>% 
  summarise(favorites = sum(favorite_count),
            tweets = n(),
            retweets = sum(retweet_count)) %>% 
  gather(metric, total, favorites:retweets) %>% 
  ggplot(aes(x=weekday, y=total)) + 
  geom_col() +
  facet_grid(metric~., scales = "free") +
  theme_bw() + 
  ggtitle("2018 @phillypaws stats by weekday")

```

```{r}
# Compare twitter activity to application activity?
cat_apps <- read.csv('../../Data/cat_apps.csv', 
                     na.strings = c(" ","","na","NA"), stringsAsFactors = F)%>% 
  janitor::clean_names() %>% 
  mutate(date_submitted = as.Date(date_submitted, "%m/%d/%Y"))

dog_apps <- read.csv('../../Data/dog_apps.csv', 
                     na.strings = c(" ","","na","NA"), stringsAsFactors = F)%>% 
  janitor::clean_names() %>% 
  mutate(date_submitted = as.Date(date_submitted, "%m/%d/%Y"))

compare_cat_apps <- cat_apps %>% 
  count(date_submitted) %>% 
  mutate(type = "cat_apps") %>% 
  rename(created_day = date_submitted)

compare_dog_apps <- dog_apps %>% 
  count(date_submitted) %>% 
  mutate(type = "dog_apps") %>% 
  rename(created_day = date_submitted)

compare_tweets <- tweets_18 %>% 
  mutate(created_day = lubridate::floor_date(created_at, unit = "day")) %>% 
  filter(created_day >= min(compare_cat_apps$created_day)) %>% 
  count(created_day) %>% 
  mutate(type = "tweets") 

compare_days  <- rbind(compare_tweets, compare_cat_apps, compare_dog_apps)

```

```{r}
# Line by day
compare_days %>% 
  group_by(type) %>% 
  mutate(percent = n/sum(n) * 100) %>% 
  ggplot(aes(x=created_day, y=percent, color=type)) + 
  geom_line() + 
  theme_bw()+
  ggtitle("Frequency of applications and tweets by day")

# Line by week
compare_days %>% 
  # remove the short week - 2018-08-26 and 2018-12-30
  filter(created_day > as.Date("2018-09-02"), created_day < as.Date("2018-12-30")) %>% 
  mutate(week = lubridate::floor_date(created_day, unit = "week")) %>% 
  group_by(type, week) %>% 
  summarise(total = sum(n)) %>% 
  mutate(percent = total/sum(total) * 100) %>% 
  ggplot(aes(x=week, y = percent)) + 
  # geom_bar(aes(fill = type), position="dodge", stat = "identity") +
  geom_line(aes(color = type))+
  theme_bw() +
  ggtitle("Frequency of applications and tweets by week")

# Scatter plot grouped by week
compare_days %>% 
  # remove the short week - 2018-08-26 and 2018-12-30
  filter(created_day > as.Date("2018-09-02"), created_day < as.Date("2018-12-30")) %>% 
  mutate(week = lubridate::floor_date(created_day, unit = "week")) %>% 
  group_by(type, week) %>% 
  summarise(total = sum(n)) %>% 
  ungroup() %>% 
  tidyr::spread(key = type, value = total) %>% 
  tidyr::gather(app_type, apps, cat_apps:dog_apps) %>% 
  ggplot(aes(x=tweets, y = apps, color=app_type)) + 
  geom_point() +
  geom_smooth(method = "lm") +
  facet_wrap(~app_type) +
  theme_bw() +
  ggtitle("Applications by tweets\nNumber per week")

```

```{r}
# What are the top words in all the tweets?
# Wrote a function to plot for a given dataset
# thanks to https://www.williamrchase.com/post/is-hadley-wickham-a-cat-or-dog-person-a-twitter-tidytext-analysis/
source('alice_plot_top_words.R')

# plot_top_words(tweets)
plot_top_words(tweets_18) + ggtitle("@phillypaws 2018 tweets\nWord frequency")

```

```{r}
# What made a tweet popular (retweets and favorites?)
tweets_18 %>% 
  mutate(has_photo = !is.na(media_type)) %>% 
  group_by(has_photo) %>% 
  summarise(favorite = mean(favorite_count, rm.na = T),
            retweet = mean(retweet_count, rm.na = T)) %>% 
  gather(metric, average, favorite:retweet) %>% 
  ggplot(aes(x=has_photo, y=average, fill = metric)) +
  geom_col(position = "dodge") + 
  theme_bw() + 
  ggtitle("Tweets with photos \nare liked and retweeted more")

```

## Conclusions and Next Steps

<span style="color:gray">*This section should have a bulletpoint list of what conclusions can be drawn from the analyses that were performed, and what next steps should be taken, both by PAWS and by R-Ladies.*</span>

Keep on tweeting! If someone wanted to dig deeper into this data, they could:

* Perform image analysis on photos tweeted
* Try to link tweets about certain topics (a specific animal, request for donations) to specific outcomes (did the animal get adopted? did they receive more donations?)
